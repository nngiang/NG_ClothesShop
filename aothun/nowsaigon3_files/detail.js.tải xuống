$(document).ready(function () {
	$("#gallery_02").owlCarousel({
		navigation : true,
		nav: true,
		navigationPage: false,
		navigationText : false,
		slideSpeed : 1000,
		pagination : true,
		dots: false,
		margin: 5,
		autoHeight:true,
		autoplay:false,
		autoplayTimeout:false,
		autoplayHoverPause:true,
		loop: false,
		responsive: {
			0: {
				items: 3
			},
			543: {
				items: 4
			},
			768: {
				items: 4
			},
			991: {
				items: 4
			},
			992: {
				items: 4
			},
			1200: {
				items: 5
			},
			1500: {
				items: 5
			}
		}
	});

	/*** xử lý active thumb -- ko variant ***/
	var thumbLargeimg = $('.details-product .large-image a').attr('href').split('?')[0];
	var thumMedium = $('#gallery_02 .owl-item .item a').find('img').attr('src');
	var url = [];

	$('#gallery_02 .owl-item .item').each(function(){
		var srcImg = '';
		$(this).find('a img').each(function(){
			var current = $(this);
			if(current.children().size() > 0) {return true;}
			srcImg += $(this).attr('src');
		});
		url.push(srcImg);
		var srcimage = $(this).find('a img').attr('src').split('?')[0];
		if (srcimage == thumbLargeimg) {
			$(this).find('a').addClass('active');
		} else {
			$(this).find('a').removeClass('active');
		}

	});
	$('#gallery_02 img, .swatch-element label').click(function(e){
		e.preventDefault();
		$('.large-image .checkurl img').attr('src',$(this).attr('data-img'));
	})
});



var ww = $(window).width();

var selectCallback = function(variant, selector) {
	$('.iwishAddWrapper').attr('data-variant',variant.id);
	if (variant) {

		var form = jQuery('#' + selector.domIdPrefix).closest('form');

		for (var i=0,length=variant.options.length; i<length; i++) {

			var radioButton = form.find('.swatch[data-option-index="' + i + '"] :radio[value="' + variant.options[i] +'"]');
			if (radioButton.size()) {
				radioButton.get(0).checked = true;
			}
			jQuery('.swatch[data-option-index="' + i + '"] :radio[value="' + variant.options[i] +'"]').removeClass('soldout').addClass('available').find(':radio').removeAttr('disabled');

		}
	}
	var addToCart = jQuery('.form-product .btn-cart'),
		form = jQuery('.form-product .form_button_details'),
		productPrice = jQuery('.details-pro .special-price .product-price'),
		qty = jQuery('.availabel'),
		sale = jQuery('.details-pro .old-price .product-price-old'),
		comparePrice = jQuery('.details-pro .old-price .product-price-old'),
		priceTopbar  = jQuery('.product_info_price_value-final'),
		title = jQuery('.product_info_price_title'),
		button = jQuery('.btn_buyNow');

	/*** VAT ***/
	if (variant){
		if (variant.taxable){
			$('.taxable').removeClass('hidden').find('.vat').text('Đã bao gồm VAT');
		} else {
			$('.taxable').removeClass('hidden').find('.vat').text('Chưa bao gồm VAT');
		}
	}
	
	
	if (variant && variant.available) {
		
		if(variant.inventory_management == "bizweb"){
			if (variant.inventory_quantity != 0) {
				qty.html('Còn hàng');
			} else if (variant.inventory_quantity == ''){
				qty.html('Hết hàng');
			}
		} else {
			qty.html('Còn hàng');
		}
		button.addClass('add_to_cart').removeAttr('disabled').text('Thêm vào giỏ hàng');
		addToCart.removeAttr('disabled').find('span').text('Thêm vào giỏ hàng');	
		addToCart.removeClass('hidden');
		button.removeClass('hidden');
		if(variant.price == 0){
			title.html('');
			button.addClass('hidden');
			priceTopbar.html('Liên hệ');
			productPrice.html('Liên hệ');	
			comparePrice.hide();
			form.addClass('hidden');
			sale.removeClass('sale');
			$('.taxable').addClass('hidden')
			if(variant.inventory_management == "bizweb"){
				if (variant.inventory_quantity != 0) {
					qty.html('Còn hàng');
				} else if (variant.inventory_quantity == ''){
					qty.html('Hết hàng');
				}
			} else {
				qty.html('Còn hàng');
			}
		}else{
			title.html('Giá bán:');
			priceTopbar.html(Bizweb.formatMoney(variant.price, "{{amount_no_decimals_with_comma_separator}}₫"));
			form.removeClass('hidden');
			productPrice.html(Bizweb.formatMoney(variant.price, "{{amount_no_decimals_with_comma_separator}}₫"));
			// Also update and show the product's compare price if necessary
			if ( variant.compare_at_price > variant.price ) {
				comparePrice.html(Bizweb.formatMoney(variant.compare_at_price, "{{amount_no_decimals_with_comma_separator}}₫")).show();
				sale.addClass('sale');
				if(variant.inventory_management == "bizweb"){
					if (variant.inventory_quantity != 0) {
						qty.html('Còn hàng');
					} else if (variant.inventory_quantity == ''){
						qty.html('Còn hàng');
					}
				} else {
					qty.html('Còn hàng');
				}
			} else {
				comparePrice.hide();  
				sale.removeClass('sale');
				if(variant.inventory_management == "bizweb"){
					if (variant.inventory_quantity != 0) {
						qty.html('Còn hàng');
					} else if (variant.inventory_quantity == ''){
						qty.html('Hết hàng');
					}
				} else {
					qty.html('Còn hàng');
				}
			}       										
		}

	} else {	
		button.removeClass('add_to_cart').text('Hết hàng').attr('disabled', 'disabled');
		qty.html('Hết hàng');
		addToCart.attr('disabled', 'disabled').find('span').text('Hết hàng');
		form.removeClass('hidden');
		if(variant){
			if(variant.price != 0){
				title.html('Giá bán:');
				priceTopbar.html(Bizweb.formatMoney(variant.price, "{{amount_no_decimals_with_comma_separator}}₫"));
				form.removeClass('hidden');
				addToCart.addClass('hidden');
				productPrice.html(Bizweb.formatMoney(variant.price, "{{amount_no_decimals_with_comma_separator}}₫"));
				// Also update and show the product's compare price if necessary
				if ( variant.compare_at_price > variant.price ) {
					form.addClass('hidden');
					comparePrice.html(Bizweb.formatMoney(variant.compare_at_price, "{{amount_no_decimals_with_comma_separator}}₫")).show();
					sale.addClass('sale');
					if(variant.inventory_management == "bizweb"){
						if (variant.inventory_quantity != 0) {
							qty.html('Còn hàng');
						} else if (variant.inventory_quantity == ''){
							qty.html('Hết hàng');
							form.removeClass('hidden');
							addToCart.removeClass('hidden');
							button.removeClass('hidden');
						}
					} else {
						qty.html('Còn hàng');
					}
				} else {
					comparePrice.hide();   
					sale.removeClass('sale');
					if(variant.inventory_management == "bizweb"){
						if (variant.inventory_quantity != 0) {
							qty.html('Còn hàng');
						} else if (variant.inventory_quantity == ''){
							qty.html('Hết hàng');
							form.removeClass('hidden');
							addToCart.removeClass('hidden');
							button.removeClass('hidden');
							priceTopbar.html(Bizweb.formatMoney(variant.price, "{{amount_no_decimals_with_comma_separator}}₫")).show();
						}
					} else {
						qty.html('Còn hàng');
					}
				}     
			}else{
				title.html('Liên hệ');
				priceTopbar.hide();
				productPrice.html('Liên hệ');	
				comparePrice.hide();
				form.addClass('hidden');	
				sale.removeClass('sale');
				addToCart.addClass('hidden');
				button.addClass('hidden');
				$('.taxable').addClass('hidden')
			}
		}else{
			title.html('Liên hệ');
			priceTopbar.hide();
			button.addClass('hidden');
			productPrice.html('Liên hệ');	
			comparePrice.hide();
			form.addClass('hidden');	
			sale.removeClass('sale');
			addToCart.addClass('hidden');
			$('.taxable').addClass('hidden')
		}

	}
	 
	 /*begin variant image*/
	 if (variant && variant.image) {  
		 var originalImage = jQuery(".large-image img"); 
		 var newImage = variant.image;
		 var element = originalImage[0];
		 Bizweb.Image.switchImage(newImage, element, function (newImageSizedSrc, newImage, element) {
			 jQuery(element).parents('a').attr('href', newImageSizedSrc);
			 jQuery(element).attr('src', newImageSizedSrc);
			 jQuery('.pict').attr('src', newImageSizedSrc);
			 if (ww >= 1200){
				 $("#img_01").data('zoom-image', newImageSizedSrc).elevateZoom({
					 responsive: true,
					 gallery:'gallery_02',
					 cursor: 'pointer',
					 galleryActiveClass: "active"
				 });
				 $("#img_01").bind("click", function(e) {
					 var ez = $('.img_02').data('elevateZoom');
				 });
			 }
		 });

		 setTimeout(function(){
			 $('.checkurl').attr('href',$(this).attr('src'));
			 if (ww >= 1200){
				 $('.zoomContainer').remove();
				 $("#img_01").elevateZoom({
					 responsive: true,
					 gallery:'gallery_02',
					 cursor: 'pointer',
					 scrollZoom : false,
					 galleryActiveClass: "active"
				 });
			 }
		 },200);

	 } 
	  
	 };
	 jQuery(function($) {
		 if(variantsize == true ){

			 new Bizweb.OptionSelectors('product-selectors', {
				 product: productJson,
				 onVariantSelected: selectCallback,
				 enableHistoryState: true
			 });
		 }

		 // Add label if only one product option and it isn't 'Title'. Could be 'Size'.
         if(productOptionsSize == 1){
             $('.selector-wrapper:eq(0)').prepend('<label>'+ optionsFirst +'</label>');
         }

         // Hide selectors if we only have 1 variant and its title contains 'Default'.
		 if(cdefault == 1){
			 $('.selector-wrapper').hide();
		 } 
		 $('.selector-wrapper').css({
			 'text-align':'left',
			 'margin-bottom':'15px'
		 });
	 });

	   jQuery('.swatch :radio').change(function() {
		   var optionIndex = jQuery(this).closest('.swatch').attr('data-option-index');
		   var optionValue = jQuery(this).val();
		   jQuery(this)
			   .closest('form')
			   .find('.single-option-selector')
			   .eq(optionIndex)
			   .val(optionValue)
			   .trigger('change');
	   });
	   if (ww >= 1200){
		   $(document).ready(function() {
			   if($(window).width()>1200){
				   $('#img_01').elevateZoom({
					   gallery:'gallery_02', 
					   zoomWindowWidth:420,
					   zoomWindowHeight:500,
					   zoomWindowOffetx: 10,
					   easing : true,
					   scrollZoom : false,
					   cursor: 'pointer', 
					   galleryActiveClass: 'active', 
					   imageCrossfade: true
				   });
			   }
		   });
	   }
	   $(".dp-flex img").click(function(e){
		   e.preventDefault();
		   var hr = $(this).attr('data-src');
		   $('#img_01').attr('src',hr);
		   $('.pict').attr('src',hr);
		   $('.large_image_url').attr('href',hr);
		   $('#img_01').attr('data-zoom-image',hr);
	   });

	   $(window).on("load resize",function(e){
		   if($(window).width()<768){					   
			   $('.product-tab .tab-link:nth-child(1) ').append('<div class="tab-content-mobile"></div>');
			   $('.product-tab .tab-link:nth-child(1) .tab-content-mobile').append($('#tab-1').html());
			   $('.product-tab .tab-link:nth-child(1)').addClass('current');

			   $('.product-tab .tab-link:nth-child(2)').append('<div class="tab-content-mobile"></div>');
			   $('.product-tab .tab-link:nth-child(2) .tab-content-mobile').append($('#tab-2').html());

			   $('.product-tab .tab-link:nth-child(3)').append('<div class="tab-content-mobile"></div>');
			   $('.product-tab .tab-link:nth-child(3) .tab-content-mobile').append($('#tab-3').html());

			   $('.product-tab .tab-content').remove();
			   $('.tab-link').click(function(e){

			   })
		   }
	   });


	   if($(window).width()<768){					   
		   $('.product-tab .tab-link:nth-child(1) ').append('<div class="tab-content-mobile"></div>');
		   $('.product-tab .tab-link:nth-child(1) .tab-content-mobile').append($('#tab-1').html());
		   $('.product-tab .tab-link:nth-child(1)').addClass('current');

		   $('.product-tab .tab-link:nth-child(2)').append('<div class="tab-content-mobile"></div>');
		   $('.product-tab .tab-link:nth-child(2) .tab-content-mobile').append($('#tab-2').html());

		   $('.product-tab .tab-link:nth-child(3)').append('<div class="tab-content-mobile"></div>');
		   $('.product-tab .tab-link:nth-child(3) .tab-content-mobile').append($('#tab-3').html());

		   $('.product-tab .tab-content').remove();

	   }

	   $(".not-dqtab").each( function(e){
		   $(this).find('.tabs-title li:first-child').addClass('current');
		   $(this).find('.tab-content').first().addClass('current');

		   $(this).find('.tabs-title li').click(function(){
			   if($(window).width()>315){	
				   if($(this).hasClass('current')){
					   $(this).removeClass('current');
				   }else{
					   var tab_id = $(this).attr('data-tab');
					   var url = $(this).attr('data-url');
					   $(this).closest('.e-tabs').find('.tab-viewall').attr('href',url);

					   $(this).closest('.e-tabs').find('.tabs-title li').removeClass('current');
					   $(this).closest('.e-tabs').find('.tab-content').removeClass('current');

					   $(this).addClass('current');
					   $(this).closest('.e-tabs').find("#"+tab_id).addClass('current');
				   }
			   }else{
				   var tab_id = $(this).attr('data-tab');
				   var url = $(this).attr('data-url');
				   $(this).closest('.e-tabs').find('.tab-viewall').attr('href',url);

				   $(this).closest('.e-tabs').find('.tabs-title li').removeClass('current');
				   $(this).closest('.e-tabs').find('.tab-content').removeClass('current');

				   $(this).addClass('current');
				   $(this).closest('.e-tabs').find("#"+tab_id).addClass('current');

			   }

		   });    
	   });
	   function scrollToxx() {
		   $('html, body').animate({ scrollTop: $('.product-tab.e-tabs').offset().top }, 'slow');
		   $('.product-tab .tab-link').removeClass('current');
		   $('.product-tab .tab-link[data-tab=tab-3]').addClass('current');
		   $('.product-tab .tab-content').removeClass('current');
		   $('.product-tab .tab-content#tab-3').addClass('current');

		   return false;
	   }
	  
	   if (ww >= 1200){
		   $(document).ready(function() {
			   $('#img_01').elevateZoom({
				   gallery:'gallery_01', 
				   zoomWindowWidth:420,
				   zoomWindowHeight:500,
				   zoomWindowOffetx: 10,
				   easing : true,
				   scrollZoom : false,
				   cursor: 'pointer', 
				   galleryActiveClass: 'active', 
				   imageCrossfade: true

			   });
		   });
	   }
	   $('#gallery_00 img, .swatch-element label').click(function(e){

		   $('.checkurl').attr('href',$(this).attr('src'));
		   if (ww >= 1200){
			   setTimeout(function(){
				   $('.zoomContainer').remove();				
				   $('#zoom_01').elevateZoom({
					   gallery:'gallery_01', 
					   zoomWindowWidth:420,
					   zoomWindowHeight:500,
					   zoomWindowOffetx: 10,
					   easing : true,
					   scrollZoom : false,
					   cursor: 'pointer', 
					   galleryActiveClass: 'active', 
					   imageCrossfade: true
				   });
			   },300);
		   }
	   });